<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>ICTLAB dashboard</title>

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" />
    <link href="https://cdn.datatables.net/1.10.11/css/dataTables.bootstrap.min.css" rel="stylesheet" />

    <style>
        .glyphicon-dy {
            padding-right: 15px;
            cursor: pointer;
        }

        .paddingLeft10{
            padding-left: 10px;
        }
    </style>

</head>
<body>
<div class="navbar navbar-inverse navbar-fixed-top">
    <div class="container">
        <div class="navbar-header">
            <a class="navbar-brand" href="index.html">Dashboardsss</a>
        </div>
    </div>
</div>
<div class="container body-content" style="margin-top: 75px;">
    <div class="row" style="padding-bottom: 10px;">
        <div class="col-sm-2">
            <button class="btn btn-primary" id="newContainer"><span class="glyphicon glyphicon-plus"></span> New Container</button>
        </div>
    </div>
    <div class="row">
        <div class="col-sm-12">
            <table id="myTable" class="table table-striped" cellspacing="0">
                <thead>
                <tr>
                    <th>Id</th>
                    <th>Container name</th>
                    <th>Creation date</th>
                    <th>State</th>
                    <th>Actions</th>
                </tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>
    </div>
    <!-- Modal -->
    <div id="myModal" class="modal fade" role="dialog">
        <div class="modal-dialog">
            <!-- Modal content-->
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                    <h4 class="modal-title">Container configuration</h4>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <div class="col-sm-6">
                            <div class="form-group">
                                <label>Container name:</label>
                                <input type="text" class="form-control" id="containerName">
                            </div>
                        </div>
                        <div class="col-sm-6">
                            <div class="form-group">
                                <label>Container description:</label>
                                <input type="text" class="form-control" id="containerDescription">
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-sm-offset-6 col-sm-6">
                            <label>Container state:</label>
                            <input type="text" class="form-control" disabled="disabled" id="containerState">
                        </div>
                    </div>
                    <div class="row" style="margin-top: 10px;">
                        <div class="col-sm-12">
                            <div class="form-group">
                                <label>
                                    Actions
                                </label>
                                <button class="btn btn-default" id="">Start<span class="glyphicon paddingLeft10 glyphicon-play"></span></button>
                                <button class="btn btn-default" id="">Restart<span class="glyphicon paddingLeft10 glyphicon-repeat"></span></button>
                                <button class="btn btn-default" id="">Move<span class="glyphicon paddingLeft10 glyphicon-export"></span></button>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" data-dismiss="modal" id="saveContainer">Save</button>
                </div>
            </div>

        </div>
    </div>
</div>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.2.3/jquery.min.js"></script>
<script type="text/javascript" src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>
<script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/1.10.11/js/jquery.dataTables.min.js"></script>
<script type="text/javascript" src="https://cdn.datatables.net/1.10.11/js/dataTables.bootstrap.min.js"></script>
<script>
    $(document).ready(function () {
        var myTable = $('#myTable');
        var host = window.location.origin;
        var url = host+ "/ictlab/api/containers/";
        console.log(url);

         var myTableDataTable = myTable.DataTable({
             "ajax" : {
                 "url": url,
                 "dataSrc": ""
             },
             "columns" : [
                 { "data" : "id" },
                 { "data" : "name" },
                 { "data" : "creationDate" },
                 { "data" : "state" },
                 {
                     "render": function (data, type, full, meta) {
                         return '<span class="glyphicon glyphicon-dy glyphicon-play start" command="start" data-toggle="tooltip" title="Start a container"></span><span class="glyphicon glyphicon-dy glyphicon-off" data-toggle="tooltip"  command="stop" title="Stop a container"></span><span class="glyphicon glyphicon-dy glyphicon-repeat" command="restart" data-toggle="tooltip" title="Restart a container"></span><span class="glyphicon glyphicon-dy glyphicon-cog" command="edit" data-toggle="tooltip" title="Edit a container"></span><span class="glyphicon glyphicon-dy glyphicon-export" command="move" data-toggle="tooltip" title="Move a container"></span>';
                     }
                 }
             ],
            "order": [[0, "asc"]]
        });

        $( "#myTable tbody" ).on( "click","span" ,function() {
            var command = $(this).attr('command');

            if(command == "start"){
                start($(this));
            }else if(command == "stop"){
                stop($(this));
            }else if(command == "restart"){
                restart($(this));
            }else if(command == "edit"){
                edit($(this));
            }else if(command == "move"){
                move($(this));
            }
        });

        function start(obj) {
            var data = myTableDataTable.row( obj.parents('tr') ).data();
            var id = data.id;
            var url = host+ "/ictlab/api/containers/" + id + "/start/";
            var parentTableRow =  obj.parents('tr');
            var row = myTableDataTable.row(obj.parents('tr'));

            console.log(url);

            $.ajax({
                type: "GET",
                dataType: "json",
                url: url,
                data: {
                    id: id
                },
                success: function (data) {
                    if (data != "Could not start container") {
                        parentTableRow.css("background-color", "yellow");
                        data.state = "Starting...";
                    } else {
                        parentTableRow.css("background-color", "red");
                        data.state = "Error";
                    }
                    row.data(data);
                    myTableDataTable.draw();
                }
            });
        }

        function stop(obj) {
            //Stop container
            var data = myTableDataTable.row( obj.parents('tr') ).data();
            var id = data.id;

            alert("Stop container " + id);
        }

        function restart(obj) {
            //Restart container
            var data = myTableDataTable.row( obj.parents('tr') ).data();
            var id = data.id;

            alert("Restarting container " +id);
        }

        function edit(obj) {
            //Edit container
            var data = myTableDataTable.row( obj.parents('tr') ).data();
            var containerName = data.name;
            var containerState = data.state;

            $("#containerName").val(containerName);
            $("#containerState").val(containerState);

            $('#myModal').modal('show');
        }

        function move(obj) {
            //Move container
            var data = myTableDataTable.row( obj.parents('tr') ).data();
            var id = data.id;

            alert("Moving container " + id);
        }


        $('#saveContainer').click(function () {
            //Save container
            alert("Saved container, will close this window now.");
        });

        $('#newContainer').click(function () {
            //TODO: newContainer maken:
            //Container name
            //Container description
            //Container image, vrije invoer.
            //Starten op node: Lijst van nodes
            alert("Creating container");
        });

        function checkResults(id) {
            //TODO: Elke 10 sec vragen aan Front-end API of container gestart is.
        }
    });
</script>
</body>
</html>