<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>ICTLAB dashboard</title>

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" />
    <link href="https://cdn.datatables.net/1.10.11/css/dataTables.bootstrap.min.css" rel="stylesheet" />

    <style>
        .glyphicon-dy {
            padding-right: 15px;
            cursor: pointer;
        }

        .paddingLeft10{
            padding-left: 10px;
        }
    </style>

</head>
<body>
<div class="navbar navbar-inverse navbar-fixed-top">
    <div class="container">
        <div class="navbar-header">
            <a class="navbar-brand" href="index.html">Dashboard</a>
        </div>
    </div>
</div>
<div class="container body-content" style="margin-top: 75px;">
    <div class="row" style="padding-bottom: 10px;">
        <div class="col-sm-2">
            <button class="btn btn-primary" id="newContainer"><span class="glyphicon glyphicon-plus"></span> New Container</button>
        </div>
    </div>
    <div class="row">
        <div class="col-sm-12">
            <table id="myTable" class="table table-striped" cellspacing="0">
                <thead>
                <tr>
                    <th>Id</th>
                    <th>Container name</th>
                    <th>State</th>
                    <th>Event</th>
                    <th>Actions</th>
                </tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>
    </div>
    <!-- Modal -->
    <div id="myModal" class="modal fade" role="dialog">
        <div class="modal-dialog">
            <!-- Modal content-->
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                    <h4 class="modal-title">Container configuration</h4>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <div class="col-sm-6">
                            <div class="form-group">
                                <label>Container name:</label>
                                <input type="text" class="form-control" id="containerName">
                            </div>
                        </div>
                        <div class="col-sm-6">
                            <div class="form-group">
                                <label>Container description:</label>
                                <input type="text" class="form-control" id="containerDescription">
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-sm-offset-6 col-sm-6">
                            <label>Container state:</label>
                            <input type="text" class="form-control" disabled="disabled" id="containerState">
                        </div>
                    </div>
                    <div class="row" style="margin-top: 10px;">
                        <div class="col-sm-12">
                            <div class="form-group">
                                <label>
                                    Actions
                                </label>
                                <button class="btn btn-default" id="">Start<span class="glyphicon paddingLeft10 glyphicon-play"></span></button>
                                <button class="btn btn-default" id="">Restart<span class="glyphicon paddingLeft10 glyphicon-repeat"></span></button>
                                <button class="btn btn-default" id="">Move<span class="glyphicon paddingLeft10 glyphicon-export"></span></button>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" data-dismiss="modal" id="saveContainer">Save</button>
                </div>
            </div>

        </div>
    </div>
</div>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.2.3/jquery.min.js"></script>
<script type="text/javascript" src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>
<script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/1.10.11/js/jquery.dataTables.min.js"></script>
<script type="text/javascript" src="https://cdn.datatables.net/1.10.11/js/dataTables.bootstrap.min.js"></script>
<script>
    $(document).ready(function () {
        var myTable = $('#myTable');
        var host = window.location.origin;

        //getContainers();
        //var url = host+ "/resources/docker/containers/get";



        var url = host+ "/containers.json";
        console.log(url);
         var myTableDataTable = myTable.DataTable({
             "ajax" : url,
             "columns" : [
                 { "data" : "id" },
                 { "data" : "name" },
                 { "data" : "creationDate" },
                 { "data" : "state" },
                 {
                     "render": function (data, type, full, meta) {
                         return '<span class="glyphicon glyphicon-dy glyphicon-play" data-toggle="tooltip" title="Start a container"></span><span class="glyphicon glyphicon-dy glyphicon-off" data-toggle="tooltip" title="Stop a container"></span><span class="glyphicon glyphicon-dy glyphicon-repeat" data-toggle="tooltip" title="Restart a container"></span><span class="glyphicon glyphicon-dy glyphicon-cog edit" data-toggle="tooltip" title="Edit a container"></span><span class="glyphicon glyphicon-dy glyphicon-export" data-toggle="tooltip" title="Move a container"></span>';
                     }
                 }
             ],
            "order": [[0, "asc"]]
        });


        $('.glyphicon-play').click(function () {
            //Start container
            alert("Clicked start");

            var rowData = getRowData($(this));
            var id = rowData[0];
            var parentTableRow =  $(this).parents('tr');

            var row = myTableDataTable.row(parentTableRow);
            var url = host+ "/resources/docker/containers/" + id + "/start";
            $.ajax({
                type: "POST",
                dataType: "json",
                url: url,
                data: {
                    id: id
                },
                success: function (data) {
                    if (data != "Could not start container") {
                        parentTableRow.css("background-color", "yellow");
                        rowData[2] = "Starting...";
                    } else {
                        parentTableRow.css("background-color", "red");
                        rowData[2] = "Error";
                    }

                    row.data(rowData);
                    myTableDataTable.draw();
                }
            });
        });

        $('.glyphicon-off').click(function () {
            //Stop container
            var data = getRowData($(this));
            var id = data[0];

            alert("Stop container " + id);
        });

        $('.glyphicon-repeat').click(function () {
            //Restart container
            var data = getRowData($(this));
            var id = data[0];

            alert("Restarting container " +id);
        });

        $('.glyphicon-cog').click(function () {
            //Edit container
            var data = getRowData($(this));
            var containerName = data[1];
            var containerState = data[2];

            $("#containerName").val(containerName);
            $("#containerState").val(containerState);

            $('#myModal').modal('show');
        });

        $('.glyphicon-export').click(function () {
            //Move container
            var data = getRowData($(this));
            var id = data[0];

            alert("Moving container " + id);
        });

        $('#saveContainer').click(function () {
            //Save container
            alert("Saved container, will close this window now.");
        });

        $('#newContainer').click(function () {
            //TODO: newContainer maken:
            //Container name
            //Container description
            //Container image, vrije invoer.
            //Starten op node: Lijst van nodes
            alert("Creating container");
        });

        function getRowData(obj) {
            var data = myTableDataTable.row(obj.parents('tr')).data();

            return data;
        }

        function checkResults(id) {
            //TODO: Elke 10 sec vragen aan Front-end API of container gestart is.
        }

        function getContainers() {
            //var url = host+"/resources/docker/containers/get";

            var url = host+ "/containers.json";
            $.getJSON(url, function(data){
                $.each(data, function (index, value) {
                    tableRow = $('<tr></tr>')

                    $.each(value, function (index, value) {
                        tableRow.append($('<td></td>').text(value));
                    });

                    tableRow.append('<td><span class="glyphicon glyphicon-dy glyphicon-play" data-toggle="tooltip" title="Start a container"></span><span class="glyphicon glyphicon-dy glyphicon-off" data-toggle="tooltip" title="Stop a container"></span><span class="glyphicon glyphicon-dy glyphicon-repeat" data-toggle="tooltip" title="Restart a container"></span><span class="glyphicon glyphicon-dy glyphicon-cog edit" data-toggle="tooltip" title="Edit a container"></span><span class="glyphicon glyphicon-dy glyphicon-export" data-toggle="tooltip" title="Move a container"></span></td>');
                    myTable.append(tableRow);
                });
            });
        }

    });
</script>
</body>
</html>